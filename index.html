<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fit Polynomial Models Over Longitudinal Data • longpoly</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Fit Polynomial Models Over Longitudinal Data">
<meta name="description" content="Functions to test, fit, and plot polynomial models to describe rates of change in longitudinal data as a function of mean performance. Floor effects in cognitive data can also be identified in a data-driven manner.">
<meta property="og:description" content="Functions to test, fit, and plot polynomial models to describe rates of change in longitudinal data as a function of mean performance. Floor effects in cognitive data can also be identified in a data-driven manner.">
<meta property="og:image" content="https://shffer.github.io/longpoly/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">longpoly</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="longpoly-">longpoly 
<a class="anchor" aria-label="anchor" href="#longpoly-"></a>
</h1>
</div>
<!-- badges: start -->
<!-- badges: end -->
<p>Longpoly provides a suite of tools to analyse longitudinal data. These are intended to be applied in instances where expected rates of change may vary across performance levels. The motivating use case for longpoly was to investigate how average rates of cognitive decline depend on level of impairment, but its utility extends to longitudinal data for other outcomes where similar relationships may be observed.</p>
<p>This approach provides a novel “performance-adjusted” measure of rates of change. Either mean performance or baseline performance can be used for this adjustment. Linear slopes are fit over an individual’s longitudinal observations, and their performance metric is calculated (i.e., mean or baseline). Next, a polynomial is fit at the group level to predict rates of change as a function of the chosen performance metric. A polynomial here allows for this relationship to be non-linear, and longpoly provides tools to select the polynomial order. <strong>Finally, the residuals from this model are extracted as a measure of the extent to which an individual’s rate of change is faster or slower <em>than is typical for their level of performance</em>.</strong></p>
<p>In the case of cognitive decline, this approach also offers a data-driven method to identify floor effects. Floor effects occur when cognitive assessments lack sensitivity to provide accurate measurements of performance in lower ranges. For longitudinal data, this means that cognitive decline in this range also cannot be reliably quantified. After fitting a polynomial model, longpoly can solve for the local minimum in the lower range of mean/baseline performance to identify the point where impaired performance becomes associated with slowed decline. While this is interpreted to reflect the range of performance where floor effects occur, it may alternatively reflect a true plateau in decline that occurs with advanced impairment. However, identifying this effect is also of interest as it is difficult to analyse rates of decline in participants in a plateau alongside those elsewhere on the spectrum of performance due to their fundamental differences. Longpoly can be used to filter out individuals with performance in the range for floor effects that it identifies.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Longpoly can be installed from <a href="https://github.com/shffer/longpoly" class="external-link">GitHub</a> as follows.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"shffer/longpoly"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Note, the below example workflow uses mean performance as the level of performance. This is the default for all longpoly functions. If baseline is preferred, add <code>performance_metric = "baseline"</code> to all function calls.</p>
<div class="section level3">
<h3 id="id_1-get-slopes-and-performance">1. Get Slopes and Performance<a class="anchor" aria-label="anchor" href="#id_1-get-slopes-and-performance"></a>
</h3>
<p>The first step in the workflow is to submit a longitudinal data set to <code><a href="reference/get_slopes_and_performance.html">get_slopes_and_performance()</a></code>. This function returns a tibble with columns for “id”, “performance_slope”, and one of either “performance_mean” or “performance_baseline” depending on the user selection (by specificing <code>performance_metric</code> = “mean” or “baseline”). For the purposes of this example, I will create a dummy dataset of five participants, each with three timepoints.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_participants</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="va">n_timepoints</span> <span class="op">=</span> <span class="fl">3</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2222</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dummy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_participants</span>, each <span class="op">=</span> <span class="va">n_timepoints</span><span class="op">)</span>,</span>
<span>  timepoint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_timepoints</span>, times <span class="op">=</span> <span class="va">n_participants</span><span class="op">)</span>,</span>
<span>  performance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_participants</span> <span class="op">*</span> <span class="va">n_timepoints</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dummy</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id timepoint performance</span></span>
<span><span class="co">#&gt; 1  1         1  -0.3380621</span></span>
<span><span class="co">#&gt; 2  1         2   0.9391643</span></span>
<span><span class="co">#&gt; 3  1         3   1.7377190</span></span>
<span><span class="co">#&gt; 4  2         1   0.6963261</span></span>
<span><span class="co">#&gt; 5  2         2   0.4622959</span></span>
<span><span class="co">#&gt; 6  2         3  -0.3150868</span></span></code></pre></div>
<p>This can now be used with <code><a href="reference/get_slopes_and_performance.html">get_slopes_and_performance()</a></code>. Load longpoly</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shffer.github.io/longpoly/">longpoly</a></span><span class="op">)</span></span></code></pre></div>
<p>Apply the function (specifying the column names)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_slopes_and_performance.html">get_slopes_and_performance</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">dummy</span>,</span>
<span>  id_col <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  time_col <span class="op">=</span> <span class="st">"timepoint"</span>,</span>
<span>  outcome_col <span class="op">=</span> <span class="st">"performance"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sm</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span><span class="co">#&gt;      id performance_slope performance_mean</span></span>
<span><span class="co">#&gt;   &lt;int&gt;             &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1             1.04             0.780</span></span>
<span><span class="co">#&gt; 2     2            -0.506            0.281</span></span>
<span><span class="co">#&gt; 3     3             0.892            1.10 </span></span>
<span><span class="co">#&gt; 4     4            -1.06             0.827</span></span>
<span><span class="co">#&gt; 5     5             1.07            -0.853</span></span></code></pre></div>
<div class="section level4">
<h4 id="a-note-about-simulated-data">A Note About Simulated Data<a class="anchor" aria-label="anchor" href="#a-note-about-simulated-data"></a>
</h4>
<p>The dummy data used for <code><a href="reference/get_slopes_and_performance.html">get_slopes_and_performance()</a></code> did not simulate any relationship between mean and slope values and is therefore of limited use in illustrating the utility of the other functions in longpoly. Rather than using this output, the remainder of this example workflow makes use of the <code>longpoly_example_data</code> example cognitive data set that is shipped with longpoly. In creating this data, 1000 mean values (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>X</mi><mo accent="true">‾</mo></mover><annotation encoding="application/x-tex">\bar{X}</annotation></semantics></math>) were initially sampled from <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N(0, 1)</annotation></semantics></math> (cognitively unimpaired participants) and another 1000 mean values were then sampled from <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>1.5</mn><mo>,</mo><mn>0.75</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N(-1.5, 0.75)</annotation></semantics></math> (participants with cognitive impairment). The data were combined and slopes (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>) were assigned conditionally as follows:</p>
<blockquote>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>0.10</mn><mo>,</mo><mn>0.2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y \sim N(-0.10, 0.2)</annotation></semantics></math>  if  <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>0.5</mn><mo>≤</mo><mover><mi>X</mi><mo accent="true">‾</mo></mover></mrow><annotation encoding="application/x-tex">-0.5 \le \bar{X}</annotation></semantics></math>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>0.30</mn><mo>,</mo><mn>0.2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y \sim N(-0.30, 0.2)</annotation></semantics></math>  if  <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>1.0</mn><mo>≤</mo><mover><mi>X</mi><mo accent="true">‾</mo></mover><mo>&lt;</mo><mo>−</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">-1.0 \le \bar{X} &lt; -0.5</annotation></semantics></math>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>0.45</mn><mo>,</mo><mn>0.2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y \sim N(-0.45, 0.2)</annotation></semantics></math>  if  <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>1.5</mn><mo>≤</mo><mover><mi>X</mi><mo accent="true">‾</mo></mover><mo>&lt;</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">-1.5 \le \bar{X} &lt; -1</annotation></semantics></math>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>0.25</mn><mo>,</mo><mn>0.2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y \sim N(-0.25, 0.2)</annotation></semantics></math>  if  <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>2.0</mn><mo>≤</mo><mover><mi>X</mi><mo accent="true">‾</mo></mover><mo>&lt;</mo><mo>−</mo><mn>1.5</mn></mrow><annotation encoding="application/x-tex">-2.0 \le \bar{X} &lt; -1.5</annotation></semantics></math>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>0.15</mn><mo>,</mo><mn>0.2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y \sim N(-0.15, 0.2)</annotation></semantics></math>  if  <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>X</mi><mo accent="true">‾</mo></mover><mo>&lt;</mo><mo>−</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\bar{X} &lt; -2</annotation></semantics></math>
</li>
</ul>
</blockquote>
<p>Given this, a non-linear relationship is expected where minimal decline is observed when mean performance is above -0.5. For those with lower mean performance, faster decline is expected until mean performance reaches -1.5 at which point decline slows again. Floor effects are therefore simulated to occur when <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>X</mi><mo accent="true">‾</mo></mover><mo>=</mo><mo>−</mo><mn>1.5</mn></mrow><annotation encoding="application/x-tex">\bar{X} = -1.5</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_data</span> <span class="op">&lt;-</span> <span class="fu">longpoly</span><span class="fu">::</span><span class="va"><a href="reference/longpoly_example_data.html">longpoly_example_data</a></span></span>
<span></span>
<span><span class="va">example_data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 10 × 3</span></span>
<span><span class="co">#&gt;       id performance_mean performance_slope</span></span>
<span><span class="co">#&gt;    &lt;int&gt;            &lt;dbl&gt;             &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1     1            0.235           0.127  </span></span>
<span><span class="co">#&gt;  2     2           -0.331           0.0715 </span></span>
<span><span class="co">#&gt;  3     3           -0.312          -0.215  </span></span>
<span><span class="co">#&gt;  4     4           -2.30            0.126  </span></span>
<span><span class="co">#&gt;  5     5           -0.171          -0.215  </span></span>
<span><span class="co">#&gt;  6     6            0.140          -0.219  </span></span>
<span><span class="co">#&gt;  7     7           -1.50           -0.735  </span></span>
<span><span class="co">#&gt;  8     8           -1.01           -0.444  </span></span>
<span><span class="co">#&gt;  9     9           -0.948          -0.372  </span></span>
<span><span class="co">#&gt; 10    10           -0.494           0.00156</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="id_2-test-polynomials">2. Test Polynomials<a class="anchor" aria-label="anchor" href="#id_2-test-polynomials"></a>
</h3>
<p>The tibble output from <code><a href="reference/get_slopes_and_performance.html">get_slopes_and_performance()</a></code> (or the example data) can be used for testing models that describe the relationship between slope and mean values using <code><a href="reference/test_polynomial.html">test_polynomial()</a></code>. This function assigns participants in to train and test data sets and fits polynomials up to a maximum order specified by the user. It returns a list containing:</p>
<ol style="list-style-type: decimal">
<li><p><strong><em>polynomial_results</em></strong> - a tibble with columns recording the order of each polynomial tested with the corresponding proportion of variance explained (PVE) in test and train data, as well as the additional PVE in the test data* for every increase in polynomial order</p></li>
<li><p><strong><em>train_ids</em></strong> - a character vector of ids allocated to the train data set in model development</p></li>
<li><p><strong><em>test_ids</em></strong> - a character vector of ids allocated to the test data set in model development</p></li>
<li><p><strong><em>scree_plot</em></strong> - a visualisation the additional PVE in the test data* for higher order polynomial models.</p></li>
</ol>
<p><br></p>
<blockquote>
<p><em>*PVE in the test data is is calculated as follows:</em></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><msub><mi>S</mi><mtext mathvariant="normal">residual</mtext></msub><mo>=</mo><mo>∑</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mover><mi>x</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">SS_{\text{residual}} = \sum (x_i - \hat{x}_i)^2</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><msub><mi>S</mi><mtext mathvariant="normal">regression</mtext></msub><mo>=</mo><mo>∑</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>x</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">SS_{\text{regression}} = \sum (\hat{x}_i - \bar{x})^2</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><msub><mi>S</mi><mtext mathvariant="normal">total</mtext></msub><mo>=</mo><mi>S</mi><msub><mi>S</mi><mtext mathvariant="normal">regression</mtext></msub><mo>+</mo><mi>S</mi><msub><mi>S</mi><mtext mathvariant="normal">residual</mtext></msub></mrow><annotation encoding="application/x-tex">SS_{\text{total}} = SS_{\text{regression}} + SS_{\text{residual}}</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>V</mi><msub><mi>E</mi><mtext mathvariant="normal">test</mtext></msub><mo>=</mo><mfrac><mrow><mi>S</mi><msub><mi>S</mi><mtext mathvariant="normal">regression</mtext></msub></mrow><mrow><mi>S</mi><msub><mi>S</mi><mtext mathvariant="normal">total</mtext></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">
PVE_{\text{test}} = \frac{SS_{\text{regression}}}{SS_{\text{total}}}
</annotation></semantics></math></p>
<p><em>Where:</em></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>i</mi></msub><annotation encoding="application/x-tex">x_i</annotation></semantics></math><em>= Calculated slope for the</em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>i</mi><mtext mathvariant="normal">th</mtext></msup><annotation encoding="application/x-tex">i^{\text{th}}</annotation></semantics></math><em>individual test set</em></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>x</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><annotation encoding="application/x-tex">\hat{x}_i</annotation></semantics></math><em>= Predicted slope for the</em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>i</mi><mtext mathvariant="normal">th</mtext></msup><annotation encoding="application/x-tex">i^{\text{th}}</annotation></semantics></math><em>individual in the test set</em></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>x</mi><mo accent="true">‾</mo></mover><annotation encoding="application/x-tex">\bar{x}</annotation></semantics></math><em>= Average of the slopes computed in the test set</em></p>
</blockquote>
<p><br></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1111</span><span class="op">)</span></span>
<span><span class="va">test_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/test_polynomial.html">test_polynomial</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">example_data</span>, test_proportion <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, max_order <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_results</span><span class="op">$</span><span class="va">polynomial_results</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span><span class="co">#&gt;   order pve_in_train_data pve_in_test_data additional_pve</span></span>
<span><span class="co">#&gt;   &lt;int&gt;             &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1            0.0365           0.0381       0.0381  </span></span>
<span><span class="co">#&gt; 2     2            0.0939           0.102        0.0639  </span></span>
<span><span class="co">#&gt; 3     3            0.148            0.170        0.0682  </span></span>
<span><span class="co">#&gt; 4     4            0.152            0.174        0.00417 </span></span>
<span><span class="co">#&gt; 5     5            0.204            0.200        0.0254  </span></span>
<span><span class="co">#&gt; 6     6            0.204            0.200        0.000795</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">test_results</span><span class="op">$</span><span class="va">scree_plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-7-1.png" width="60%" height="40%"></p>
<p>These outputs suggest that additional PVE plateaus at models of the 4th order or higher indicating that a 3rd order polynomial is appropriate for the example data set.</p>
</div>
<div class="section level3">
<h3 id="id_2a-find-polynomial">2a Find Polynomial<a class="anchor" aria-label="anchor" href="#id_2a-find-polynomial"></a>
</h3>
<p>Visual assessment of the scree plot above may not always readily discern an appropriate polynomial order and a data driven approach may be preferred. The <code><a href="reference/find_polynomial.html">find_polynomial()</a></code>function offers an alternative approach to selecting a model that addresses this. Specifically, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>max</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>P</mi><mi>V</mi><msub><mi>E</mi><mrow><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\max(PVE_{test})</annotation></semantics></math> across all models is extracted, and the most parsimonious model with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>V</mi><mi>E</mi><mo>≥</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mi>a</mi><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>P</mi><mi>V</mi><msub><mi>E</mi><mrow><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">PVE \ge (max(PVE_{test}) - x)</annotation></semantics></math> (where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math> is a user defined threshold) is selected. This allows the user to determine a trade-off between model fit (and potential overfitting) and model simplicity. The function returns a list containing:</p>
<ol style="list-style-type: decimal">
<li><p><strong><em>polynomial_results</em></strong> - a tibble with columns recording the order of each polynomial tested with the corresponding proportion of variance explained (PVE) in test and train data (these columns will be identical to those returned from <code><a href="reference/test_polynomial.html">test_polynomial()</a></code> if the same data and seed are used)</p></li>
<li><p><strong><em>selected_order</em></strong> - the order of the selected model (based on the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>P</mi><mi>V</mi><msub><mi>E</mi><mrow><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">max(PVE_{test}) - x</annotation></semantics></math> criteria)</p></li>
<li><p><strong><em>selected_model_coefficients</em></strong> - coefficients of the selected model (based on the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>P</mi><mi>V</mi><msub><mi>E</mi><mrow><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">max(PVE_{test}) - x</annotation></semantics></math> criteria)</p></li>
<li><p><strong><em>train_ids</em></strong> - a character vector of ids allocated to the train data set in model development</p></li>
<li><p><strong><em>test_ids</em></strong> - a character vector of ids allocated to the test data set in model development</p></li>
</ol>
<p><br></p>
<p>Setting <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">x = 0.05</annotation></semantics></math> with the example data returns the following</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1111</span><span class="op">)</span></span>
<span><span class="va">find_poly_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/find_polynomial.html">find_polynomial</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">example_data</span>, test_proportion <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, max_order <span class="op">=</span> <span class="fl">6</span>, x <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span><span class="va">find_poly_results</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">#&gt; $polynomial_results</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   order pve_in_train_data pve_in_test_data</span></span>
<span><span class="co">#&gt;   &lt;int&gt;             &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1            0.0365           0.0381</span></span>
<span><span class="co">#&gt; 2     2            0.0939           0.102 </span></span>
<span><span class="co">#&gt; 3     3            0.148            0.170 </span></span>
<span><span class="co">#&gt; 4     4            0.152            0.174 </span></span>
<span><span class="co">#&gt; 5     5            0.204            0.200 </span></span>
<span><span class="co">#&gt; 6     6            0.204            0.200 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $selected_order</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $selected_model_coefficients</span></span>
<span><span class="co">#&gt;                            (Intercept) poly(performance_mean, 3, raw = TRUE)1 </span></span>
<span><span class="co">#&gt;                           -0.164037069                            0.129172597 </span></span>
<span><span class="co">#&gt; poly(performance_mean, 3, raw = TRUE)2 poly(performance_mean, 3, raw = TRUE)3 </span></span>
<span><span class="co">#&gt;                           -0.004785321                           -0.018976382</span></span></code></pre></div>
<p>The function selects the third order polynomial and is given by <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mo>−</mo><mn>0.164</mn><mo>+</mo><mn>0.129</mn><mi>x</mi><mo>−</mo><mn>0.005</mn><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>0.019</mn><msup><mi>x</mi><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">y = -0.164 + 0.129x - 0.005x^2 - 0.019x^3</annotation></semantics></math>. While this agrees with <code><a href="reference/test_polynomial.html">test_polynomial()</a></code>, note that a more conservative value for <code>x</code> would have selected a higher order model. For example <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>0.02</mn></mrow><annotation encoding="application/x-tex">x = 0.02</annotation></semantics></math> would select the fifth order model since no lower order models have <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>V</mi><msub><mi>E</mi><mrow><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mo>≥</mo><mn>0.18</mn></mrow><annotation encoding="application/x-tex">PVE_{test} \ge 0.18</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="id_3-implement-polynomial">3. Implement Polynomial<a class="anchor" aria-label="anchor" href="#id_3-implement-polynomial"></a>
</h3>
<p>After selecting a polynomial order (typically either by reviewing the scree plot output by <code><a href="reference/test_polynomial.html">test_polynomial()</a></code> or by using <code><a href="reference/find_polynomial.html">find_polynomial()</a></code> to select on the data-driven process described above), this model is implemented using <code><a href="reference/implement_polynomial.html">implement_polynomial()</a></code>. An optional parameter, <code>floor_effects()</code>, determines whether individuals with floor effects should be identified. If this is set to true, the <code>floor_range()</code> argument must be specified and reflects the range in mean values over which a minimum value for slope will be found. The function returns a list with the following:</p>
<ol style="list-style-type: decimal">
<li>
<strong><em>model_formula</em></strong> — the formula of the final model</li>
<li>
<strong><em>final_data</em></strong> — a tibble with columns for “id”, “performance_slope”, “performance_mean”, “predicted_slope”, and “residual”. If <code>floor_effects = TRUE</code>, an additional column “floor_effects” is appended with either “keep” or “remove” reflecting whether the record should be removed based on the identified performance_mean threshold for floor effects</li>
<li>
<strong><em>threshold</em></strong> — if floor_effects = TRUE, this records the threshold used for floor effect classifications</li>
</ol>
<p>For the example data, Steps 2 and 2a (above) selected a third order polynomial. Implementing this model returns the following</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poly_out</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="reference/implement_polynomial.html">implement_polynomial</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">example_data</span>,</span>
<span>    order <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    floor_effects <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    floor_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">example_data</span><span class="op">$</span><span class="va">performance_mean</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">poly_out</span><span class="op">$</span><span class="va">model_formula</span></span>
<span><span class="co">#&gt; [1] "y = -0.164 +0.129x -0.005x^2 -0.019x^3"</span></span>
<span></span>
<span><span class="co"># temporarily shorten names in final_data so example can be printed without spilling over</span></span>
<span><span class="va">poly_out</span><span class="op">$</span><span class="va">final_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"performance_"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">poly_out</span><span class="op">$</span><span class="va">final_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span><span class="co">#&gt;      id   mean   slope predicted_slope residual floor_effects</span></span>
<span><span class="co">#&gt;   &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;           &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;        </span></span>
<span><span class="co">#&gt; 1     1  0.235  0.127           -0.134   0.261  keep         </span></span>
<span><span class="co">#&gt; 2     2 -0.331  0.0715          -0.207   0.278  keep         </span></span>
<span><span class="co">#&gt; 3     3 -0.312 -0.215           -0.204  -0.0105 keep         </span></span>
<span><span class="co">#&gt; 4     4 -2.30   0.126           -0.255   0.381  remove       </span></span>
<span><span class="co">#&gt; 5     5 -0.171 -0.215           -0.186  -0.0289 keep         </span></span>
<span><span class="co">#&gt; 6     6  0.140 -0.219           -0.146  -0.0725 keep</span></span>
<span></span>
<span><span class="va">poly_out</span><span class="op">$</span><span class="va">threshold</span></span>
<span><span class="co">#&gt; [1] -1.592723</span></span></code></pre></div>
<p>Importantly, a “residual” column has been added in the <code>final_data</code> tibble. <strong>This is the performance-adjusted measure of rate of change that is the intended output from <code>longpoly</code>.</strong></p>
<p><em>Note also that the floor effects threshold has been identified at -1.59. The example data were simulated to show floor effects when mean performance &lt; -1.5 (</em><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>±</mo><annotation encoding="application/x-tex">\pm</annotation></semantics></math><em>a noise factor) so this is a reasonable approximation of what was expected.</em></p>
</div>
<div class="section level3">
<h3 id="id_4-plot-polynomial">4. Plot Polynomial<a class="anchor" aria-label="anchor" href="#id_4-plot-polynomial"></a>
</h3>
<p><code>plot_polyomial()</code> can be used to produce plots of a polynomial of a given order in the train and test data sets during model development (using the id vectors produced by <code><a href="reference/test_polynomial.html">test_polynomial()</a></code> or <code>find_polynomial</code> to define these), in the whole cohort, and in the whole cohort with keep/remove status based on floor effects assigned (use the threshold from <code><a href="reference/implement_polynomial.html">implement_polynomial()</a></code> for this). These plots are returned as <code>ggplot</code> objects in a named list.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="reference/plot_polynomial.html">plot_polynomial</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">poly_out</span><span class="op">$</span><span class="va">final_data</span>,</span>
<span>    order <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    whole_cohort_title <span class="op">=</span> <span class="st">"Selected Polynomial in Whole Cohort"</span>,</span>
<span>    whole_cohort_only <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    train_id <span class="op">=</span> <span class="va">test_results</span><span class="op">$</span><span class="va">train_ids</span>,</span>
<span>    test_id <span class="op">=</span> <span class="va">test_results</span><span class="op">$</span><span class="va">test_ids</span>,</span>
<span>    train_title <span class="op">=</span> <span class="st">"Selected Polynomial in Train Cohort"</span>,</span>
<span>    test_title <span class="op">=</span> <span class="st">"Selected Polynomial in Test Cohort"</span>,</span>
<span>    keep_remove <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    threshold <span class="op">=</span> <span class="va">poly_out</span><span class="op">$</span><span class="va">threshold</span>,</span>
<span>    threshold_linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>    threshold_line_color <span class="op">=</span> <span class="st">"#5f6a7a"</span>,</span>
<span>    annotate_floor_thresh <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    legend_position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">plots</span></span>
<span><span class="co">#&gt; Warning: Computation failed in `stat_regline_equation()`.</span></span>
<span><span class="co">#&gt; Caused by error:</span></span>
<span><span class="co">#&gt; ! object 'performance_slope' not found</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-10-1.png" width="60%" height="60%"><img src="README_files/figure-gfm/unnamed-chunk-10-2.png" width="60%" height="60%"><img src="README_files/figure-gfm/unnamed-chunk-10-3.png" width="60%" height="60%"></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co">#&gt; Warning: Computation failed in `stat_regline_equation()`.</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt; Caused by error:</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt; ! object 'performance_slope' not found</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-10-4.png" width="60%" height="60%"></p>
</div>
<div class="section level3">
<h3 id="id_5-data-filtering">5. Data Filtering<a class="anchor" aria-label="anchor" href="#id_5-data-filtering"></a>
</h3>
<p>Simulated data offers the benefit of knowing what our results <em>should</em> look like. We expected a third order polynomial with a floor effect when mean performance <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mo>−</mo><mn>1.5</mn></mrow><annotation encoding="application/x-tex">\approx -1.5</annotation></semantics></math>, as was seen. However, our final model also shows a prominent downward slope in its right tail that gives the impression that faster decline (more negative slopes) is expected when mean values exceed a value of approximately 2. This was not an effect that was simulated to exist – in fact, slopes were sampled from <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>0.10</mn><mo>,</mo><mn>0.2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N(-0.10, 0.2)</annotation></semantics></math> for all mean values <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo><mo>−</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">\ge -0.5</annotation></semantics></math> meaning that the polynomial should be flat in this region to reflect the “true” effect.</p>
<p>This observation reflects the (misleading) influence that scarce data points in the extremes of the distribution of mean performance can exert. Assessment of the whole cohort plot above suggests that, for data with mean performance &gt; 2, random sampling led to an over representation of more negative slopes. Review of the data in this range confirms this.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">performance_mean</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">performance_slope</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">summary</span></span>
<span><span class="co">#&gt;  performance_slope</span></span>
<span><span class="co">#&gt;  Min.   :-0.4833  </span></span>
<span><span class="co">#&gt;  1st Qu.:-0.2842  </span></span>
<span><span class="co">#&gt;  Median :-0.1766  </span></span>
<span><span class="co">#&gt;  Mean   :-0.1760  </span></span>
<span><span class="co">#&gt;  3rd Qu.:-0.1244  </span></span>
<span><span class="co">#&gt;  Max.   : 0.2519</span></span></code></pre></div>
<p>If we sampled enough observations in this range, these summary statistics would instead reflect the distribution from which it was sampled. However, these mean values come from the Cognitively Unimpaired participants (see ‘A Note About Simulated Data’ above) and were sampled from <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N(0,1)</annotation></semantics></math>. A score of 2 is therefore 2SD from the mean of its distribution and explains why data are scarce in this range.</p>
<p>The function <code><a href="reference/filter_slopes_and_mean.html">filter_slopes_and_mean()</a></code> filters data in the extreme ranges for mean values according to user-defined criteria. A window reflecting the “width” of the extreme range is defined and a minimum number of observations for that range is defined. If the actual number of observations is less than the specified minimum, data in the window are removed. This can be performed on the left or right tails (or both), and if data points are removed from either, the polynomial fitting process (i.e., Steps 2 to 4) should be repeated.</p>
<p>Since the values in the right tail in the example data were simulated from a separate distribution ( <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N(0,1)</annotation></semantics></math> ) than those in the left ( <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>1.5</mn><mo>,</mo><mn>0.75</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N(-1.5, 0.75)</annotation></semantics></math> ), I will perform filtering separately. For the right tail, I will set the window size to capture values above 2 (i.e., those more than 2SD above the distribution mean), and require at least 25 (out of 1000) observations in that range.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filtered_example_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/filter_slopes_and_mean.html">filter_slopes_and_mean</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">example_data</span>,</span>
<span>  window_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">example_data</span><span class="op">$</span><span class="va">performance_mean</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span>,</span>
<span>  min_obs <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  max_filter <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  min_filter <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "number of observations in max window:  22"</span></span>
<span><span class="co">#&gt; [1] "user defined miniumum number of observations:  25"</span></span>
<span><span class="co">#&gt; [1] "data in max window removed"</span></span></code></pre></div>
<p>I will now filter this data set for ranges in the left tail. For this, I will set the window size to capture any mean values less than - 3 (i.e., those more than 2SD below the distribution mean) and again require at least 25 observations.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filtered_example_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/filter_slopes_and_mean.html">filter_slopes_and_mean</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">filtered_example_data</span>,</span>
<span>  window_size <span class="op">=</span> <span class="op">-</span><span class="fl">3</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">filtered_example_data</span><span class="op">$</span><span class="va">performance_mean</span><span class="op">)</span>,</span>
<span>  min_obs <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  max_filter <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  min_filter <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "number of observations in min window:  37"</span></span>
<span><span class="co">#&gt; [1] "user defined miniumum number of observations:  25"</span></span>
<span><span class="co">#&gt; [1] "data in min window not removed"</span></span></code></pre></div>
<p>For brevity, I will skip the <code>test_polynomial</code> and <code>find_polynomial</code> steps and instead implement a third order polynomial and filter for floor effects (but in practice, the chosen development steps should not be skipped).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poly_out_filtered</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="reference/implement_polynomial.html">implement_polynomial</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">filtered_example_data</span>,</span>
<span>    order <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    floor_effects <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    floor_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">filtered_example_data</span><span class="op">$</span><span class="va">performance_mean</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">plots_filtered</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="reference/plot_polynomial.html">plot_polynomial</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">poly_out_filtered</span><span class="op">$</span><span class="va">final_data</span>,</span>
<span>    order <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    whole_cohort_title <span class="op">=</span> <span class="st">"Selected Polynomial in Whole Cohort"</span>,</span>
<span>    whole_cohort_only <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    keep_remove <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    threshold <span class="op">=</span> <span class="va">poly_out_filtered</span><span class="op">$</span><span class="va">threshold</span>,</span>
<span>    threshold_linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>    threshold_line_color <span class="op">=</span> <span class="st">"#5f6a7a"</span>,</span>
<span>    annotate_floor_thresh <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    legend_position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">plots_filtered</span><span class="op">$</span><span class="va">keep_remove</span></span>
<span><span class="co">#&gt; Warning: Computation failed in `stat_regline_equation()`.</span></span>
<span><span class="co">#&gt; Caused by error:</span></span>
<span><span class="co">#&gt; ! object 'performance_slope' not found</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-14-1.png" width="60%" height="60%"></p>
<p>Based on our minimum count of 25 observations, the maximum range of mean scores was filtered (n = 22 with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>X</mi><mo accent="true">‾</mo></mover><annotation encoding="application/x-tex">\bar{X}</annotation></semantics></math> &gt; 2) but not the minimum range (n = 37 with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>X</mi><mo accent="true">‾</mo></mover><annotation encoding="application/x-tex">\bar{X}</annotation></semantics></math> &lt; -3). The identified threshold (now -1.6) did not change meaningfully from its previous value (i.e., -1.59), but the downward trend on the right tail is now less prominent.</p>
<p>The residuals from this model can now be extracted from the participants above the floor effects threshold:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poly_out_filtered</span><span class="op">$</span><span class="va">final_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">floor_effects</span> <span class="op">==</span> <span class="st">"keep"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">residual</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 10 × 2</span></span>
<span><span class="co">#&gt;       id residual</span></span>
<span><span class="co">#&gt;    &lt;int&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1     1   0.258 </span></span>
<span><span class="co">#&gt;  2     2   0.276 </span></span>
<span><span class="co">#&gt;  3     3  -0.0132</span></span>
<span><span class="co">#&gt;  4     5  -0.0319</span></span>
<span><span class="co">#&gt;  5     6  -0.0760</span></span>
<span><span class="co">#&gt;  6     7  -0.428 </span></span>
<span><span class="co">#&gt;  7     8  -0.164 </span></span>
<span><span class="co">#&gt;  8     9  -0.0977</span></span>
<span><span class="co">#&gt;  9    10   0.226 </span></span>
<span><span class="co">#&gt; 10    11   0.129</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing longpoly</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Shane Fernandez <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-4881-245X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Shane Fernandez.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
